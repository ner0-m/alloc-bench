import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
import os

mpl.style.use('seaborn')

def my_plot(figure_title):
    fig, (ax1, ax2) = plt.subplots(2)
    fig.suptitle(figure_title, fontsize=14)

    # multiple line plot
    ax1.plot(bytes[:25], allocs[:25], linestyle='-', label="Libstdc++ malloc", color="firebrick")
    ax1.plot(bytes[:25], frees[:25], linestyle='--', label="Libstdc++ free", color="firebrick")

    ax1.plot(bytes[1:25], tbb_allocs[1:25], linestyle='-', label="TBB scalabe malloc", color="darkgreen")
    ax1.plot(bytes[:25], tbb_frees[:25], linestyle='--', label="TBB scalable free", color="darkgreen")

    ax1.set_xscale('log', base=2)
    ax1.legend(loc="upper left")

    ax1.set_title("Libstdc++ vs TBB allocation")
    ax1.set_xlabel("Allocation size")
    ax1.set_ylabel("Time")

    end = allocs.size
    ax2.plot(bytes[23:end], allocs[23:end], linestyle='-', label="Libstdc++ malloc", color="firebrick")
    ax2.plot(bytes[23:end], frees[23:end], linestyle='--', label="Libstdc++ free", color="firebrick")

    ax2.plot(bytes[23:end], tbb_allocs[23:end], linestyle='-', label="TBB scalabe malloc", color="darkgreen")
    ax2.plot(bytes[23:end], tbb_frees[23:end], linestyle='--', label="TBB scalable free", color="darkgreen")

    ax2.set_xscale('log', base=2)
    ax2.legend(loc="upper left")

    ax2.set_title("Libstdc++ vs TBB allocation")
    ax2.set_xlabel("Allocation size")
    ax2.set_ylabel("Time")

    plt.show()


bytes = np.array([1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024, 2048, 4096, 8192, 16384, 32768, 65536, 131072, 262144, 524288, 1048576, 2097152, 4194304, 8388608, 16777216, 33554432, 67108864, 134217728, 268435456, 536870912, 1073741824])
allocs = np.array([4.6499990276061e-06, 4.4000003072142135e-06, 4.370000169728883e-06, 4.370000169728883e-06, 4.529999387159478e-06, 4.36000073023024e-06, 4.3100008042529225e-06, 4.5799993131367955e-06, 4.539999281405471e-06, 4.2800011215149425e-06, 4.539999281405471e-06, 5.349996172299143e-06, 6.989992471062578e-06, 8.629999683762435e-06, 6.5999934122373816e-06, 6.649993338214699e-06, 8.199995136237703e-06, 6.5699937294994015e-06, 9.87000748864375e-06, 9.190001946990378e-06, 1.2100027561245952e-05, 9.57000520429574e-06, 1.0010008736571763e-05, 9.660006071499083e-06, 9.630006388761103e-06, 0.00020983115246053785, 0.00021356991783250123, 0.00021180005569476634, 0.00021035013196524233, 0.00022360995353665203, 0.00020149997726548463])
frees = np.array([4.559999069897458e-06, 4.549999175651465e-06, 4.559999069897458e-06, 4.549998720904114e-06, 4.509999598667491e-06, 4.499999249674147e-06, 4.489999355428154e-06, 4.499999249674147e-06, 4.50999914392014e-06, 4.499999249674147e-06, 4.989996341464575e-06, 4.779997652804013e-06, 4.819997229787987e-06, 4.729998181574047e-06, 4.909996732749278e-06, 4.909996732749278e-06, 9.400007002113853e-06, 5.0299963731959e-06, 9.610006600269116e-06, 7.979996553331148e-06, 1.0040008419309743e-05, 9.3200051196618e-06, 9.010002941067796e-06, 9.280004633183125e-06, 9.170003977487795e-06, 0.00035909994039684534, 0.00037280996912159026, 0.00040471996180713177, 0.0004630209587048739, 0.000538031046744436, 0.0006496610585600138])
tbb_allocs = np.array([0.00013853008567821234, 4.839997473027324e-06, 4.819997229787987e-06, 4.829997578781331e-06, 4.989997250959277e-06, 8.370000614377204e-06, 4.919997536489973e-06, 7.589994766021846e-06, 4.919997536489973e-06, 7.819994607416447e-06, 4.929997430735966e-06, 9.280005542677827e-06, 5.0299963731959e-06, 3.0390010579139926e-05, 1.0150011803489178e-05, 9.820011655392591e-06, 1.006001366476994e-05, 1.0090010619023815e-05, 9.920012416841928e-06, 1.2650016287807375e-05, 1.4900017049512826e-05, 1.527001404610928e-05, 2.6919997253571637e-05, 3.275998096796684e-05, 3.1659994419896975e-05, 3.209001442883164e-05, 0.00045120096183381975, 0.0004474898742046207, 0.0004508899000938982, 0.0004948300775140524, 0.0003743398410733789])
tbb_frees = np.array([4.959997568221297e-06, 4.619998890120769e-06, 4.629998329619411e-06, 4.73999807582004e-06, 4.7199973778333515e-06, 4.70999839308206e-06, 5.299998065311229e-06, 5.209997652855236e-06, 5.339997187547851e-06, 5.5499954214610625e-06, 5.3799976740265265e-06, 5.329996838554507e-06, 5.279997822071891e-06, 5.179996605875203e-06, 5.049996161687886e-06, 5.05999605593388e-06, 5.019996024202555e-06, 5.179996605875203e-06, 1.4100013686402235e-05, 5.099996542412555e-06, 5.2099958338658325e-06, 6.149994533188874e-06, 1.6279995179502293e-05, 1.5169987818808295e-05, 1.542998870718293e-05, 1.5399988114950247e-05, 0.00047402005293406546, 0.0005100409034639597, 0.0005709701217710972, 0.0007147298310883343, 0.0007657600217498839])

my_plot(figure_title="Linear growth, direct free")

allocs = np.array([3.5600000956037547e-06, 3.4899999263870995e-06, 1.4099999816608033e-06, 1.1199999789823778e-06, 1.3300000318849925e-06, 2.530000074330019e-06, 7.189999905676814e-06, 6.950000170036219e-06, 1.0159999874304049e-05, 1.8740000086836517e-05, 2.4510000002919696e-05, 4.163999983575195e-05, 7.154999912017956e-05, 9.729000157676637e-05, 0.00010979000217048451, 0.0001284809986827895, 0.0001414500002283603, 0.0001913799933390692, 0.00019108099513687193, 0.0001839500037021935, 0.00020472999312914908, 0.00023802999930921942, 0.00022298999829217792, 0.00023500999668613076, 0.0002146299957530573, 0.00022971999715082347, 0.00021688999549951404, 0.00021485000615939498, 0.00021888999617658556, 0.00022960000205785036, 0.000285660004010424])
frees = np.array([1.2399999604895129e-06, 1.1800000265793642e-06, 1.13999999484804e-06, 1.0799999472510535e-06, 1.0700000530050602e-06, 1.0799999472510535e-06, 1.0799999472510535e-06, 2.900000026784255e-06, 3.150000111418194e-06, 9.309999768447597e-06, 3.2299999475071672e-06, 8.609999895270448e-06, 2.271999983349815e-05, 3.0049999622860923e-05, 4.095999975106679e-05, 4.003999856649898e-05, 4.068999987794086e-05, 0.00020974999642930925, 0.00022452000121120363, 0.00023919000523164868, 0.00027258999762125313, 0.000358180986950174, 0.0003645599936135113, 0.00036457000533118844, 0.00034227001015096903, 0.0003794300137087703, 0.0003746100119315088, 0.0003979500033892691, 0.0004529900033958256, 0.0006395099917426705, 0.0009590809931978583])
tbb_allocs = np.array([0.00013800000306218863, 1.6499999446750735e-06, 1.610000026630587e-06, 1.630000042496249e-06, 1.7500000240033842e-06, 4.779999926540768e-06, 1.730000008137722e-06, 4.580000222631497e-06, 4.970000190951396e-06, 5.17999978910666e-06, 7.520000053773401e-06, 1.7410000509698875e-05, 2.3880000298959203e-05, 0.0001939899957505986, 0.00019693000649567693, 0.0001768100046319887, 0.00021085000480525196, 0.0002346800029044971, 0.0002913599892053753, 0.00038431098801083863, 0.0006432500085793436, 0.0006593000143766403, 0.00048609101213514805, 0.0008829410071484745, 0.0009324710117653012, 0.0009076609858311713, 0.000638719997368753, 0.00047158999950625, 0.00047314001130871475, 0.0005671510007232428, 0.000587009999435395])
tbb_frees = np.array([2.9499999527615728e-06, 1.4900000451234519e-06, 1.3500000477506546e-06, 1.3100000160193304e-06, 3.0500000320898835e-06, 2.9200000426499173e-06, 5.160000000614673e-06, 6.790000043110922e-06, 1.3019999641983304e-05, 1.404999966325704e-05, 2.6730000172392465e-05, 5.881999823031947e-05, 5.1139999413862824e-05, 5.2099999265919905e-06, 6.10999995842576e-06, 8.320000233652536e-06, 2.852000034181401e-05, 5.779999810329173e-06, 5.729999884351855e-06, 1.0390000170446001e-05, 0.00016387000505346805, 0.0004182000120636076, 1.8880000425269827e-05, 1.9080000129179098e-05, 4.406999869388528e-05, 0.0002880399988498539, 0.00048786099068820477, 0.0005124009912833571, 0.0005849309964105487, 0.0008434199844487011, 0.0010962500236928463])

my_plot("Linear growth, delayed free")

allocs = np.array([5.000000058430487e-08, 5.99999978589949e-08, 2.999999892949745e-08, 3.999999975690116e-08, 6.999999868639861e-08, 3.999999975690116e-08, 3.999999975690116e-08, 3.999999975690116e-08, 3.999999975690116e-08, 2.999999892949745e-08, 2.999999892949745e-08, 6.800000278417428e-07, 6.800000278417428e-07, 5.900000132896821e-07, 6.999999868639861e-07, 8.499999921696144e-07, 9.299999987888441e-07, 6.000000212225132e-07, 9.999999974752427e-07, 1.030000021273736e-06, 1.2000000424450263e-06, 1.030000021273736e-06, 1.2100000503778574e-06, 1.3300000318849925e-06, 1.2399999604895129e-06, 1.0700000530050602e-06, 1.8499999896448571e-06, 1.0700000530050602e-06, 1.249999968422344e-06, 1.259999976355175e-06])
frees = np.array([1.269999984288006e-06, 1.13999999484804e-06, 8.499999921696144e-07, 8.999999749903509e-07, 1.0799999472510535e-06, 1.1700000186465331e-06, 1.2199999446238508e-06, 7.400000185953104e-07, 7.699999855503847e-07, 1.4800000371906208e-06, 6.8700001065735705e-06, 1.3050000234215986e-05, 1.7039999875123613e-05, 2.0280000171624124e-05, 2.3660000806557946e-05, 2.282999957969878e-05, 8.217000140575692e-05, 8.743999933358282e-05, 9.138099994743243e-05, 0.00011174000246683136, 0.00015746999997645617, 0.00015423999866470695, 0.00014155999815557152, 0.0001496399927418679, 0.00016156000492628664, 0.00020314000721555203, 0.0002130799985025078, 0.00025375999393872917, 0.0003255699994042516, 0.000408291001804173])
tbb_allocs = np.array([5.000000058430487e-08, 2.999999892949745e-08, 3.999999975690116e-08, 3.999999975690116e-08, 2.999999892949745e-08, 5.000000058430487e-08, 2.999999892949745e-08, 3.999999975690116e-08, 2.999999892949745e-08, 2.999999892949745e-08, 1.3500000477506546e-06, 2.999999892949745e-08, 6.500000040432496e-07, 9.400000067216752e-07, 6.000000212225132e-07, 6.399999961104186e-07, 8.700000080352766e-07, 1.8999999440438842e-07, 9.599999657439184e-07, 3.839999862975674e-06, 2.159999894502107e-06, 2.3099998998077353e-06, 1.9999999949504854e-06, 2.190000031987438e-06, 2.2700000954500865e-06, 2.2300000637187622e-06, 2.1400001060101204e-06, 3.0700000479555456e-06, 3.260000084992498e-06, 3.2800001008581603e-06])
tbb_frees = np.array([2.9600000743812416e-06, 1.150000002780871e-06, 2.429999995001708e-06, 2.3699999474047218e-06, 4.25000007453491e-06, 7.76999968365999e-06, 6.570000095962314e-06, 1.111999972636113e-05, 1.3969999599794392e-05, 3.011999979207758e-05, 3.170000127283856e-05, 2.4560000383644365e-05, 6.010000106471125e-06, 8.609999895270448e-06, 4.810000064026099e-06, 5.089999831398018e-06, 1.0959999599435832e-05, 7.210000148916151e-06, 1.7750000552041456e-05, 0.00012533999688457698, 0.00018325999553781003, 0.0001915500033646822, 9.134999709203839e-05, 2.7950000003329478e-05, 6.125000072643161e-05, 0.0001740099978633225, 0.00025509099941700697, 0.0002913599892053753, 0.0003872700035572052, 0.00044554000487551093])

my_plot("Random allocation, delayed free")
